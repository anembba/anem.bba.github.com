(function () {
    "use strict";

    angular.module("app", ['ui.router', 'ngStorage'])
        .constant("config", {
            URL: "https://anem.info",
            DIST:"/dist",
            DOCUMENTS: "/api/documents.json",
            SLIDES: "/api/slides.json"
        });

} ());
(function (app) {
    "use strict";

    app.config(configure);

    configure.$inject = ["$stateProvider", "$urlRouterProvider"];

    function configure($stateProvider, $urlRouterProvider) {

        $urlRouterProvider.otherwise('/');

        $stateProvider
            .state('home', {
                url: '/',
                templateUrl: "views/main.html",
                controller: "controller.main",
                controllerAs: "vm"
            })
            .state('about', {
                url: '/about',
                templateUrl: "views/about.html",
                controller: "controller.about",
                controllerAs: "vm"
            })
            .state('contact', {
                url: '/contact',
                templateUrl: "views/contact.html",
                controller: "controller.contact",
                controllerAs: "vm"
            })
            .state('download', {
                url: '/download',
                templateUrl: "views/download.html",
                controller: "controller.download",
                controllerAs: "vm"
            });
    };
} (angular.module("app")));
// dataservice factory
(function (app) {

    app.factory('dataservice', dataservice);

    dataservice.$inject = ['$http', 'storage', 'config'];

    function dataservice($http, storage, config) {

        return {
            getSlides: getSlides,
            getDocuments: getDocuments
        };

        function getSlides() {
            return $http.get(config.SLIDES)
                .then(function (response) {
                    return response.data.slides;
                });
        };

        function getDocuments() {
            return $http.get(config.DOCUMENTS )
                .then(function (response) {
                    angular.forEach(response.data.docs, function (doc) {
                        doc.filename = getFileName(doc.path);
                    });
                    return response.data;
                });

        };

        function getFileName(fullPath) {
            var filename = fullPath.replace(/^.*[\\\/]/, '');
            return filename.substring(0, filename.indexOf('.'))

        };

        function getOneComplete(response) {
            return response.data;
        };

        function getAllComplete(response) {
            return response.data;
        };

        function getAllFailed(error) {
            logger.error('XHR Failed .' + error.data);
        };
    }
} (angular.module('app')));
// storage.js
(function (app) {
    'use strict';

    
    app.factory('storage', storage)

    storage.$inject = ['$localStorage'];

    function storage($localStorage) {
        return {
            getSlides: getSlides,
        }

        function getSlides(url) {
            return $localStorage[url];
        }

        function saveSlides(url, books) {
            $localStorage[url] = books;
        }


    }
})(angular.module('app'));
// logger.js
(function(app) {
    'use strict';

    angular
        .module('app')
        .factory('logger', logger);

    function logger() { }
})(angular.module('app'));
(function (app) {
    "use strict";

    app.directive('resolveLoader', function ($rootScope, $timeout) {

        return {
            restrict: 'E',
            replace: true,
            template: '<div class="alert alert-success ng-hide"><strong>Welcome!</strong> Content is loading, please hold.</div>',
            link: function (scope, element) {

                $rootScope.$on('$routeChangeStart', function (event, currentRoute, previousRoute) {
                    if (previousRoute) return;

                    $timeout(function () {
                        element.removeClass('ng-hide');
                    });
                });

                $rootScope.$on('$routeChangeSuccess', function () {
                    element.addClass('ng-hide');
                });
            }
        };
    });
} (angular.module('app')));

(function (app) {
    "use strict";

    app.controller("controller.about", controller);

    controller.$inject = ["config"];
    function controller(config) {

        var self = this;
        self.contents = config.DIST;
    };
} (angular.module("app")));        
(function (app) {
    "use strict";

    app.controller("controller.contact", controller);

    controller.$inject = [];

    function controller() {

        var self = this;
    };
} (angular.module("app")));        
(function (app) {
    "use strict";

    app.controller("controller.download", controller);

    controller.$inject = ["dataservice", "config"];

    function controller(dataservice, config) {
        var self = this;
        self.title = "Documents à télécharger";
        self.documents = {};
        self.contents = config.DIST;
        dataservice.getDocuments()
            .then(function (response) {
                self.documents = response;
            });

    };
} (angular.module("app")));        
(function (app) {
    "use strict";

    app.controller("controller.main", controller);

    controller.$inject = ["dataservice", "config"];

    function controller(dataservice, config) {
        var self = this;
        self.slides = {
            list: []
        };

        self.contents = config.DIST;

        init();
        function init() {
            dataservice.getSlides()
                .then(function (slides) {
                    self.slides.list = slides;
                    $('.carousel').carousel({ interval: 6000 })
                })
        }

    };
} (angular.module("app")));        