(function () {
    "use strict";

    angular.module("app", ['ui.router', 'ngStorage'])
        .constant("config", {
            URL: "https://anem.info",
            DOCUMENTS: "https://anem.info/api/documents.json",
            SLIDES: "https://anem.info/api/slides.json"
        });

} ());
(function (app) {
    "use strict";

    app.config(configure);

    // configure.$inject = ["$routeProvider", "$locationProvider"];
    configure.$inject = ["$stateProvider", "$urlRouterProvider"];


    function configure($stateProvider, $urlRouterProvider) {
        
        $urlRouterProvider.otherwise('/');

        $stateProvider
            .state('home', {
                url: '/',
                templateUrl: "views/main.html",
                controller: "controller.main",
                controllerAs: "vm"
            })
            .state('about', {
                url: '/about',
                templateUrl: "views/about.html",
                controller: "controller.about",
                controllerAs: "vm"
            })
            .state('contact', {
                url: '/contact',
                templateUrl: "views/contact.html",
                controller: "controller.contact",
                controllerAs: "vm"
            })
            .state('download', {
                url: '/download',
                templateUrl: "views/download.html",
                controller: "controller.download",
                controllerAs: "vm"
            });
            };
 

        function configureRoute($routeProvider, $locationProvider) {
            $routeProvider
                .when("/about", {
                    templateUrl: "views/about.html",
                    controller: "controller.main as vm",
                    controllerAs: "vm"

                })
                .when("/", {
                    templateUrl: "views/main.html",
                    controller: "controller.main as vm",
                    controllerAs: "vm"

                })
                .when("/contact", {
                    templateUrl: "views/contact.html",
                    controller: "controller.contact as vm",
                    controllerAs: "vm"

                })
                .when("/download", {
                    templateUrl: "views/download.html",
                    controller: "controller.download as vm",
                    controllerAs: "vm"

                })
                .otherwise({ redirectTo: '/' });

            $locationProvider.html5Mode(true);

            // ng-storage config
            //  $localStorageProvider.setKeyPrefix('bookstore');

    }

    } (angular.module("app")));
// dataservice factory
(function (app) {

    app.factory('dataservice', dataservice);

    dataservice.$inject = ['$http', 'storage', 'config'];

    function dataservice($http, storage, config) {

        return {
            getSlides: getSlides,
            getDocuments: getDocuments
        };

        function getSlides() {
            return $http.get(config.SLIDES)
                .then(function (response) {
                    return response.data.slides;
                });
        };

        function getDocuments() {
            return $http.get(config.DOCUMENTS )
                .then(function (response) {
                    angular.forEach(response.data.docs, function (doc) {
                        doc.filename = getFileName(doc.path);
                    });
                    return response.data;
                });

        };

        function getFileName(fullPath) {
            var filename = fullPath.replace(/^.*[\\\/]/, '');
            return filename.substring(0, filename.indexOf('.'))

        };

        function getOneComplete(response) {
            return response.data;
        };

        function getAllComplete(response) {
            return response.data;
        };

        function getAllFailed(error) {
            logger.error('XHR Failed .' + error.data);
        };
    }
} (angular.module('app')));
// storage.js
(function (app) {
    'use strict';

    
    app.factory('storage', storage)

    storage.$inject = ['$localStorage'];

    function storage($localStorage) {
        return {
            getSlides: getSlides,
        }

        function getSlides(url) {
            return $localStorage[url];
        }

        function saveSlides(url, books) {
            $localStorage[url] = books;
        }


    }
})(angular.module('app'));
// logger.js
(function(app) {
    'use strict';

    angular
        .module('app')
        .factory('logger', logger);

    function logger() { }
})(angular.module('app'));
(function (app) {
    "use strict";

    app.controller("controller.about", controller);

    controller.$inject = [  "$location", "$rootScope" ];

    function controller(  $location, $rootScope) {
        var self = this;
        self.contents  = "/dist";
        $rootScope.currentPath = $location.path();

    };
}(angular.module("app")));        
(function (app) {
    "use strict";

    app.controller("controller.contact", controller);

    controller.$inject = [ "$location", "$rootScope" ];

    function controller(  $location, $rootScope) {
        var self = this;
        self.contents  = "/dist";
        $rootScope.currentPath = $location.path();
        
    };
}(angular.module("app")));        
(function (app) {
    "use strict";

    app.controller("controller.download", controller);

    controller.$inject = [ "$location", "$rootScope", "dataservice"];

    function controller($location, $rootScope, dataservice) {
        var self = this;
        self.title = "Documents à télécharger";
        self.documents = {};
        self.contents = "/dist";
        $rootScope.currentPath = $location.path();

        dataservice.getDocuments()
            .then(function (response) {
                self.documents = response;
            });

    };
} (angular.module("app")));        
(function (app) {
    "use strict";

    app.controller("controller.main", controller);

    controller.$inject = [ "$location", "$rootScope", "dataservice"];

    function controller( $location, $rootScope, dataservice) {
        var self = this;
        self.slides = {
            list: []
        };

        self.contents = "/dist";

        $rootScope.currentPath = $location.path();

        init();
        function init() {
            dataservice.getSlides()
                .then(function (slides) {
                    self.slides.list = slides;
                    $('.carousel').carousel({
                        interval: 6000 //changes the speed
                    })
                })
        }

    };
} (angular.module("app")));        